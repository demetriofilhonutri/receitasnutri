   
       <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtro de Receitas - Demétrio Filho Nutri</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2C5F6F;
            --secondary-color: #8FA383;
            --accent-color: #DE8744;
            --text-dark: #333333;
            --text-light: #666;
            --background-light: #f8f9fa;
            --border-color: #dee2e6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: #f4f7f6;
            padding: 20px; 
            min-height: 100vh;
            color: var(--text-dark);
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); 
            overflow: hidden; 
        }
        
        .header { 
            background: var(--primary-color);
            color: white; 
            padding: 40px 30px; 
            text-align: center; 
        }
        
        .logo-img { 
            width: 120px; 
            height: 120px;
            margin: 0 auto 20px;
            object-fit: contain;
        }
        
        .header h1 { 
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5em; 
            margin-bottom: 8px; 
            font-weight: 700;
        }
        
        .header .subtitle { 
            font-size: 1.2em; 
            opacity: 0.9; 
            margin-bottom: 20px; 
        }
        
        .header .instagram { 
            display: inline-block;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1.1em; 
            opacity: 0.95;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .header .instagram:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .content { 
            padding: 40px; 
        }
        
        .info-box { 
            background: #f0f4f0; 
            border-left: 5px solid var(--secondary-color); 
            padding: 25px; 
            border-radius: 8px; 
            margin-bottom: 30px; 
        }
        
        .info-box h3 { 
            color: var(--primary-color); 
            margin-bottom: 10px;
            font-family: 'Montserrat', sans-serif;
        }

        .info-box p {
            line-height: 1.6;
        }
        
        .filters { 
            background: var(--background-light); 
            padding: 30px; 
            border-radius: 10px; 
            margin-bottom: 30px; 
            border: 1px solid var(--border-color);
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
align-items: end;
        }

        .filter-section h3 { 
            color: var(--primary-color); 
            margin-bottom: 15px; 
            font-size: 1.1em;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
        }
        
        .filter-group { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
        }
        
        .filter-group label { 
            font-size: 0.9em; 
            color: var(--text-light); 
            font-weight: 500; 
        }
        
        .filter-group input, .filter-group select { 
            padding: 12px; 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            font-size: 1em; 
            width: 100%; 
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .filter-group input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(143, 163, 131, 0.2);
        }
        
        .checkbox-group { 
            display: flex; 
            gap: 20px; 
            flex-wrap: wrap; 
        }
        
        .checkbox-item { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .checkbox-item input[type="checkbox"] { 
            width: 18px; 
            height: 18px; 
            cursor: pointer; 
            accent-color: var(--secondary-color); 
        }
        
        .btn { 
            padding: 12px 25px; 
            border: none; 
            border-radius: 8px; 
            font-size: 1em; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
        }
        
        .btn-primary { 
            background: var(--primary-color); 
            color: white; 
        }
        .btn-primary:hover {
            background: #224a57;
        }

        .actions { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 20px; 
            flex-wrap: wrap; 
        }
        
        .results-info { 
            background: #e9f1ff; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            border-left: 5px solid var(--primary-color); 
        }
        
        .table-container { 
            overflow-x: auto; 
            border-radius: 10px; 
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            background: white; 
        }
        
        thead { 
            background: var(--primary-color); 
            color: white; 
        }
        
        th { 
            padding: 18px 20px; 
            text-align: left; 
            font-weight: 600; 
            font-size: 0.95em;
            font-family: 'Montserrat', sans-serif; 
        }
        
        td { 
            padding: 18px 20px; 
            border-bottom: 1px solid var(--border-color); 
        }

        td strong {
            font-weight: 500;
        }
        
        tbody tr {
            transition: background-color 0.2s;
        }
        tbody tr:hover { 
            background: #f1f5f9; 
        }
        
        .tag { 
            display: inline-block; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.85em; 
            font-weight: 500; 
        }
        
        .tag-lactose { 
            background: #fff3cd; 
            color: #856404; 
        }
        
        .tag-no-lactose { 
            background: #d4edda; 
            color: #155724; 
        }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        
        .modal-content { 
            background: white; 
            padding: 40px; 
            border-radius: 15px; 
            max-width: 650px; 
            width: 90%; 
            max-height: 90vh; 
            overflow-y: auto; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header h2 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .modal-actions { 
            display: flex; 
            gap: 10px; 
            justify-content: flex-end; 
            margin-top: 30px; 
        }

        .instructions-list {
            list-style-type: none;
            counter-reset: step-counter;
            padding-left: 0;
            margin: 0;
            color: var(--text-dark);
        }
        .instructions-list li {
            counter-increment: step-counter;
            margin-bottom: 18px;
            display: flex;
            align-items: flex-start;
            line-height: 1.6;
        }
        .instructions-list li:last-child {
            margin-bottom: 0;
        }
        .instructions-list li::before {
            content: counter(step-counter);
            margin-right: 15px;
            background-color: var(--secondary-color);
            color: white;
            font-weight: bold;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-family: 'Montserrat', sans-serif;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://i.ibb.co/FLSGH3rr/logo-FUNDO-TRANSPARENTE-18.png" alt="logo-FUNDO-TRANSPARENTE-18" border="0"></a>
            <h1>Demétrio Filho Nutri</h1>
            <p class="subtitle">Filtro de Receitas Saudáveis</p>
            <p class="instagram">📱 @demetriofilhonutri</p>
        </div>
        <div class="content">
            <div class="info-box">
                <h3>👋 Bem-vindo(a)!</h3>
                <p>Utilize os filtros abaixo para encontrar receitas que se encaixem perfeitamente em seus objetivos. Todas foram cuidadosamente selecionadas para promover uma alimentação saudável e equilibrada.</p>
            </div>
            <div class="filters">
                <div class="filter-grid">
                    <div class="filter-section">
                        <h3>🔎 Buscar por Nome</h3>
                        <div class="filter-group">
                            <input type="text" id="searchName" placeholder="Ex: Crepioca, Salada..." onkeyup="applyFilters()">
                        </div>
                    </div>
                    <div class="filter-section">
                        <h3>🔥 Calorias (kcal)</h3>
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <div class="filter-group"><label>Mínimo</label><input type="number" id="caloriesMin" placeholder="0" onkeyup="applyFilters()"></div>
                            <div class="filter-group"><label>Máximo</label><input type="number" id="caloriesMax" placeholder="1000" onkeyup="applyFilters()"></div>
                        </div>
                    </div>
                    <div class="filter-section">
                        <h3>💪 Macronutrientes (g)</h3>
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <div class="filter-group"><label>Prot. Mín</label><input type="number" id="proteinMin" placeholder="0" onkeyup="applyFilters()"></div>
                            <div class="filter-group"><label>Carb. Máx</label><input type="number" id="carbsMax" placeholder="100" onkeyup="applyFilters()"></div>
                            <div class="filter-group"><label>Gord. Máx</label><input type="number" id="fatMax" placeholder="50" onkeyup="applyFilters()"></div>
                        </div>
                    </div>
 </div>
                    </div>
                     <div class="filter-section">
                        <h3>🍰 Preferências</h3>
                         <div class="checkbox-group" style="margin-bottom: 30px; justify-content: center;">
                            <div class="checkbox-item"><input type="checkbox" id="filterDoce" checked onchange="applyFilters()"><label>Doce</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filterSalgado" checked onchange="applyFilters()"><label>Salgado</label></div>
                         <div class="checkbox-group">
                            <div class="checkbox-item"><input type="checkbox" id="filterWithLactose" checked onchange="applyFilters()"><label>Com lactose</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filterWithoutLactose" checked onchange="applyFilters()"><label>Sem lactose</label></div>
                        </div>
                    </div>
                    <div class="filter-section">
                        <h3>🍳 Método de Preparo</h3>
                        <div class="checkbox-group" style="margin-bottom: 30px; justify-content: center;">
                            <div class="checkbox-item"><input type="checkbox" id="filterStove" checked onchange="applyFilters()"><label>Fogão</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filterOven" checked onchange="applyFilters()"><label>Forno</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filterMicrowave" checked onchange="applyFilters()"><label>Micro-ondas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filterAirfryer" checked onchange="applyFilters()"><label>Air Fryer</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="filterNoHeat" checked onchange="applyFilters()"><label>Sem fogo</label></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="exportToPdf()">📄 Exportar para PDF</button>
            </div>
            <div class="results-info"><strong id="resultsCount">0</strong> receitas encontradas</div>
            <div class="table-container">
                <table id="recipesTable"><thead><tr><th>Nome</th><th>Calorias</th><th>Lactose</th><th>Preparo</th><th>Ações</th></tr></thead><tbody id="recipesBody"></tbody></table>
            </div>
        </div>
    </div>

    <div class="modal" id="viewRecipeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="viewRecipeTitle">Detalhes da Receita</h2>
            </div>
            <div id="viewRecipeContent" style="line-height: 1.7;"></div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeViewModal()">Fechar</button>
            </div>
        </div>
    </div>
     
     <script src="receitas.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script>
        let recipes = [];
        let filteredRecipes = [];
        const methodLabels = {'fogao': 'Fogão', 'forno': 'Forno', 'microondas': 'Micro-ondas', 'airfryer': 'Air Fryer', 'semfogo': 'Sem fogo'};
        
              recipes = [...defaultRecipes];
        
        function viewRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            document.getElementById('viewRecipeTitle').textContent = recipe.name;
            
            let instructionsHtml = '';
            if (recipe.instructions) {
                const instructionsList = recipe.instructions.split('\n').filter(line => line.trim() !== '');
                instructionsHtml = `
                <div>
                    <h3 style="font-family: 'Montserrat', sans-serif; color: var(--primary-color); font-size: 1.3em; margin-bottom: 15px; border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px;">
                        👨‍🍳 Modo de Preparo
                    </h3>
                    <div style="background: var(--background-light); padding: 25px; border-radius: 10px;">
                        <ol class="instructions-list">
                            ${instructionsList.map(item => `<li>${item.replace(/^\d+\.\s*/, '')}</li>`).join('')}
                        </ol>
                    </div>
                </div>`;
            }

            const content = `
                <div style="margin-bottom: 25px;">
                    <h3 style="font-family: 'Montserrat', sans-serif; color: var(--primary-color); font-size: 1.3em; margin-bottom: 15px; border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px;">
                        📊 Informações Nutricionais
                    </h3>
                    <div style="background: var(--background-light); padding: 20px; border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
                            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9em;">Calorias</p>
                                <p style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: bold; color: var(--accent-color);">${recipe.calories} kcal</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9em;">Proteínas</p>
                                <p style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: bold; color: var(--secondary-color);">${recipe.protein}g</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9em;">Carboidratos</p>
                                <p style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: bold; color: var(--primary-color);">${recipe.carbs}g</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center;">
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9em;">Gorduras</p>
                                <p style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: bold; color: var(--accent-color);">${recipe.fat}g</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${recipe.ingredients ? `
                <div style="margin-bottom: 25px;">
                    <h3 style="font-family: 'Montserrat', sans-serif; color: var(--primary-color); font-size: 1.3em; margin-bottom: 15px; border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px;">
                        🛒 Ingredientes
                    </h3>
                    <div style="background: var(--background-light); padding: 25px; border-radius: 10px;">
                        <p style="white-space: pre-line; margin: 0; color: var(--text-dark); line-height: 1.8;">${recipe.ingredients}</p>
                    </div>
                </div>
                ` : ''}
                
                ${instructionsHtml}
            `;
            
            document.getElementById('viewRecipeContent').innerHTML = content;
            document.getElementById('viewRecipeModal').classList.add('active');
        }
        
        function closeViewModal() {
            document.getElementById('viewRecipeModal').classList.remove('active');
        }
        
        function applyFilters() {
            const searchName = document.getElementById('searchName').value.toLowerCase().trim();
            const caloriesMin = parseFloat(document.getElementById('caloriesMin').value) || 0;
            const caloriesMax = parseFloat(document.getElementById('caloriesMax').value) || Infinity;
            const proteinMin = parseFloat(document.getElementById('proteinMin').value) || 0;
            const carbsMax = parseFloat(document.getElementById('carbsMax').value) || Infinity;
            const fatMax = parseFloat(document.getElementById('fatMax').value) || Infinity;
            const withLactose = document.getElementById('filterWithLactose').checked;
            const withoutLactose = document.getElementById('filterWithoutLactose').checked;
            const showDoce = document.getElementById('filterDoce').checked;
            const showSalgado = document.getElementById('filterSalgado').checked;
            const methods = [];
            if (document.getElementById('filterStove').checked) methods.push('fogao');
            if (document.getElementById('filterOven').checked) methods.push('forno');
            if (document.getElementById('filterMicrowave').checked) methods.push('microondas');
            if (document.getElementById('filterAirfryer').checked) methods.push('airfryer');
            if (document.getElementById('filterNoHeat').checked) methods.push('semfogo');
            
            filteredRecipes = recipes.filter(r => {
                const nameMatch = r.name.toLowerCase().includes(searchName);
                
                return nameMatch &&
                       r.calories >= caloriesMin && r.calories <= caloriesMax &&
                       r.protein >= proteinMin && r.carbs <= carbsMax && r.fat <= fatMax &&
                       ((withLactose && r.lactose === 'sim') || (withoutLactose && r.lactose === 'nao')) &&
                       ((showDoce && r.type === 'doce') || (showSalgado && r.type === 'salgado')) &&
                       methods.includes(r.method);
            });
            renderTable();
        }
        
        function renderTable() {
            const tbody = document.getElementById('recipesBody');
            tbody.innerHTML = '';
            document.getElementById('resultsCount').textContent = filteredRecipes.length;
            
            if (filteredRecipes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #999;">Nenhuma receita encontrada. Tente ajustar seus filtros.</td></tr>';
                return;
            }
            
            filteredRecipes.forEach(r => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${r.name}</strong></td>
                    <td>${r.calories} kcal</td>
                    <td><span class="tag ${r.lactose === 'sim' ? 'tag-lactose' : 'tag-no-lactose'}">${r.lactose === 'sim' ? 'Com lactose' : 'Sem lactose'}</span></td>
                    <td>${methodLabels[r.method]}</td>
                    <td><button class="btn btn-primary" onclick="viewRecipe(${r.id})">Ver Detalhes</button></td>
                `;
                tbody.appendChild(row);
            });
        }
        
     function exportToPdf() {
            if (filteredRecipes.length === 0) {
                alert('Nenhuma receita para exportar. Aplique filtros diferentes.');
                return;
            }

            // Explicitly get jsPDF constructor
             const jsPDF = window.jspdf.jsPDF;
             if (!jsPDF) {
                 alert("Erro: A biblioteca jsPDF não foi carregada corretamente.");
                 return;
             }
             const doc = new jsPDF();


            // --- Configurações Iniciais ---
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 15;
            const maxLineWidth = pageWidth - margin * 2;
            let finalY = 0;
            let startY = 30;

            // --- Título Principal e Data ---
            doc.setFont(undefined, 'bold');
            doc.setFontSize(18);
            doc.setTextColor("#2C5F6F"); // <-- CORRIGIDO para Hex String
            doc.text("Relatório de Receitas Saudáveis", margin, 15);

            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);
            doc.setTextColor("#646464"); // <-- CORRIGIDO para Hex String (cinza)
            doc.text(`Gerado em: ${new Date().toLocaleDateString()}`, margin, 22);

            // --- Tabela Resumo ---
            try {
                doc.autoTable({
                    html: '#recipesTable',
                    startY: startY,
                    headStyles: {
                        fillColor: "#2C5F6F", // <-- CORRIGIDO para Hex String
                        fontStyle: 'bold'
                    },
                    bodyStyles: {},
                    didDrawPage: function (data) {
                        if (data.pageNumber > 1) {}
                    }
                });
                // Ensure finalY is a number, default to startY if table fails unexpectedly
                finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY : startY;
            } catch (e) {
                console.error("Erro ao gerar autoTable:", e);
                alert("Ocorreu um erro ao gerar a tabela resumo do PDF. Verifique o console para detalhes.");
                finalY = startY; // Define a fallback Y position
                // return; // Decide if you want to abort or continue without the table
            }

            let currentY = finalY + 15;

            // --- Função auxiliar para adicionar texto e gerenciar página ---
            function addText(text, options, isTitle = false) {
                 const safeText = String(text || '');

                // Estimate text height *before* potentially adding a page
                let textHeight = 0;
                try {
                     textHeight = doc.getTextDimensions(safeText, { maxWidth: maxLineWidth, fontSize: options.fontSize || 10 }).h;
                } catch(e) {
                     console.warn("Could not calculate text dimensions, using estimate:", safeText, e);
                     textHeight = (options.fontSize || 10) * 0.5; // Basic estimate
                }

                // Check page break more accurately
                if (currentY + textHeight + (options.spacing || (isTitle ? 5 : 3)) > pageHeight - margin) {
                    doc.addPage();
                    currentY = margin + 5;
                }

                doc.setFontSize(options.fontSize || 10);
                doc.setFont(undefined, options.fontStyle || 'normal');
                // CORREÇÃO AQUI: Use Hex String, with default
                doc.setTextColor(options.color || "#333333");

                doc.text(safeText, margin, currentY, { maxWidth: maxLineWidth });

                currentY += textHeight + (options.spacing || (isTitle ? 5 : 3));

            }

            // --- Adiciona Detalhes de Cada Receita Filtrada ---
            try {
                filteredRecipes.forEach((recipe, index) => {

                    if (index > 0) {
                       // Check page break before adding space
                        if (currentY + 10 > pageHeight - margin) {
                            doc.addPage();
                            currentY = margin + 5;
                        } else {
                            currentY += 10;
                        }
                    }

                    // Nome da Receita
                    addText(recipe.name, { fontSize: 14, fontStyle: 'bold', color: "#2C5F6F", spacing: 6 }, true);

                    // Informações Nutricionais
                    addText("Informações Nutricionais:", { fontSize: 11, fontStyle: 'bold', color: "#2C5F6F", spacing: 4 }, true);
                    addText(
                        `Calorias: ${recipe.calories} kcal | Proteínas: ${recipe.protein}g | Carboidratos: ${recipe.carbs}g | Gorduras: ${recipe.fat}g`,
                        { fontSize: 10, spacing: 5 }
                    );
                    addText(
                        `Lactose: ${recipe.lactose === 'sim' ? 'Com lactose' : 'Sem lactose'} | Preparo: ${methodLabels[recipe.method]} | Tipo: ${recipe.type === 'doce' ? 'Doce' : 'Salgado'}`,
                        { fontSize: 10, spacing: 8 }
                    );


                    // Ingredientes
                    if (recipe.ingredients) {
                        addText("Ingredientes:", { fontSize: 11, fontStyle: 'bold', color: "#2C5F6F", spacing: 4 }, true);
                        const ingredientsList = recipe.ingredients.split('\n');
                        ingredientsList.forEach(item => {
                            if(item.trim() !== "") {
                                addText(`• ${item.trim()}`, { fontSize: 10, spacing: 2 });
                            }
                        });
                         // Check page break before adding space
                         if (currentY + 5 > pageHeight - margin) { doc.addPage(); currentY = margin + 5;} else { currentY += 5; }
                    }

                    // Modo de Preparo
                    if (recipe.instructions) {
                        addText("Modo de Preparo:", { fontSize: 11, fontStyle: 'bold', color: "#2C5F6F", spacing: 4 }, true);
                        const instructionsList = recipe.instructions.split('\n').filter(line => line.trim() !== '');
                        instructionsList.forEach((step, stepIndex) => {
                            let stepText = `${stepIndex + 1}. ${step.replace(/^\d+\.\s*/, '').trim()}`;
                            addText(stepText, { fontSize: 10, spacing: 3 });
                        });
                         // Check page break before adding space
                         if (currentY + 5 > pageHeight - margin) { doc.addPage(); currentY = margin + 5;} else { currentY += 5; }
                    }
                });
            } catch (e) {
                 console.error("Erro ao adicionar detalhes da receita ao PDF:", e);
                 alert("Ocorreu um erro ao processar os detalhes das receitas para o PDF. Verifique o console para detalhes.");
                 return;
            }

            // --- Salva o PDF ---
            try {
                doc.save('receitas_detalhadas_demetriofilonutri.pdf');
            } catch (e) {
                 console.error("Erro ao salvar o PDF:", e);
                 alert("Ocorreu um erro ao salvar o arquivo PDF. Verifique o console para detalhes.");
            }
        }
        
        document.addEventListener("DOMContentLoaded", () => {
            applyFilters();
        });
    </script>
</body>
</html>
